"use strict";(self.webpackChunkibt_import=self.webpackChunkibt_import||[]).push([[424],{84424:(e,r,i)=>{i.d(r,{loadIbtFile:()=>F});var s=i(72256);const t=(0,s.BFSRequire)("fs");var a=i(75848),n=i.n(a);const d={varType:{0:{size:1,iracingType:"irsdk_char",jsBufferMethod:"toString"},1:{size:1,iracingType:"irsdk_bool",jsBufferMethod:"readInt8"},2:{size:4,iracingType:"irsdk_int",jsBufferMethod:"readInt32LE"},3:{size:4,iracingType:"irsdk_bitField",jsBufferMethod:"readUInt32LE"},4:{size:4,iracingType:"irsdk_float",jsBufferMethod:"readFloatLE"},5:{size:8,iracingType:"irsdk_double",jsBufferMethod:"readDoubleLE"}},irsdk_EngineWarnings:{irsdk_waterTempWarning:1,irsdk_fuelPressureWarning:2,irsdk_oilPressureWarning:4,irsdk_engineStalled:8,irsdk_pitSpeedLimiter:16,irsdk_revLimiterActive:32,irsdk_oilTempWarning:64},irsdk_Flags:{irsdk_checkered:1,irsdk_white:2,irsdk_green:4,irsdk_yellow:8,irsdk_red:16,irsdk_blue:32,irsdk_debris:64,irsdk_crossed:128,irsdk_yellowWaving:256,irsdk_oneLapToGreen:512,irsdk_greenHeld:1024,irsdk_tenToGo:2048,irsdk_fiveToGo:4096,irsdk_randomWaving:8192,irsdk_caution:16384,irsdk_cautionWaving:32768,irsdk_black:65536,irsdk_disqualify:131072,irsdk_servicible:262144,irsdk_furled:524288,irsdk_repair:1048576,irsdk_startHidden:268435456,irsdk_startReady:536870912,irsdk_startSet:1073741824,irsdk_startGo:2147483648},irsdk_TrkLoc:{irsdk_NotInWorld:-1,irsdk_OffTrack:0,irsdk_InPitStall:1,irsdk_AproachingPits:2,irsdk_OnTrack:3},irsdk_TrkSurf:{irsdk_SurfaceNotInWorld:-1,irsdk_UndefinedMaterial:0,irsdk_Asphalt1Material:1,irsdk_Asphalt2Material:2,irsdk_Asphalt3Material:3,irsdk_Asphalt4Material:4,irsdk_Concrete1Material:5,irsdk_Concrete2Material:6,irsdk_RacingDirt1Material:7,irsdk_RacingDirt2Material:8,irsdk_Paint1Material:9,irsdk_Paint2Material:10,irsdk_Rumble1Material:11,irsdk_Rumble2Material:12,irsdk_Rumble3Material:13,irsdk_Rumble4Material:14,irsdk_Grass1Material:15,irsdk_Grass2Material:16,irsdk_Grass3Material:17,irsdk_Grass4Material:18,irsdk_Dirt1Material:19,irsdk_Dirt2Material:20,irsdk_Dirt3Material:21,irsdk_Dirt4Material:22,irsdk_SandMaterial:23,irsdk_Gravel1Material:24,irsdk_Gravel2Material:25,irsdk_GrasscreteMaterial:26,irsdk_AstroturfMaterial:27},irsdk_SessionState:{irsdk_StateInvalid:0,irsdk_StateGetInCar:1,irsdk_StateWarmup:2,irsdk_StateParadeLaps:3,irsdk_StateRacing:4,irsdk_StateCheckered:5,irsdk_StateCoolDown:6},irsdk_CarLeftRight:{irsdk_LROff:0,irsdk_LRClear:1,irsdk_LRCarLeft:2,irsdk_LRCarRight:3,irsdk_LRCarLeftRight:4,irsdk_LR2CarsLeft:5,irsdk_LR2CarsRight:6},irsdk_CameraState:{irsdk_IsSessionScreen:1,irsdk_IsScenicActive:2,irsdk_CamToolActive:4,irsdk_UIHidden:8,irsdk_UseAutoShotSelection:16,irsdk_UseTemporaryEdits:32,irsdk_UseKeyAcceleration:64,irsdk_UseKey10xAcceleration:128,irsdk_UseMouseAimMode:256},irsdk_PitSvFlags:{irsdk_LFTireChange:1,irsdk_RFTireChange:2,irsdk_LRTireChange:4,irsdk_RRTireChange:8,irsdk_FuelFill:16,irsdk_WindshieldTearoff:32,irsdk_FastRepair:64},irsdk_PitSvStatus:{irsdk_PitSvNone:0,irsdk_PitSvInProgress:1,irsdk_PitSvComplete:2,irsdk_PitSvTooFarLeft:100,irsdk_PitSvTooFarRight:101,irsdk_PitSvTooFarForward:102,irsdk_PitSvTooFarBack:103,irsdk_PitSvBadAngle:104,irsdk_PitSvCantFixThat:105},irsdk_PaceMode:{irsdk_PaceModeSingleFileStart:0,irsdk_PaceModeDoubleFileStart:1,irsdk_PaceModeSingleFileRestart:2,irsdk_PaceModeDoubleFileRestart:3,irsdk_PaceModeNotPacing:4},irsdk_PaceFlags:{irsdk_PaceFlagsEndOfLine:1,irsdk_PaceFlagsFreePass:2,irsdk_PaceFlagsWavedAround:4}};var o=i(92164),l=i.n(o);const k=new WeakMap;class c{constructor(e,r){this._buff=e,k.set(this,r)}getParam(e){const r=k.get(this).find((r=>r.name.toLowerCase()===e.toLowerCase()));if(!r)return null;const i=d.varType[r.type],s=this._buff.slice(r.offset,r.offset+i.size);return{name:r.name,description:r.description,value:s[i.jsBufferMethod](),unit:r.unit}}toJSON(){const e=l().prop("name"),r=l().compose(l().pick(["value","unit"]),(e=>this.getParam(e)),e);return k.get(this).reduce(((i,s)=>l().assoc(e(s),r(s),i)),{})}}class _{constructor(e){this.version=e[0],this.status=e[1],this.tickRate=e[2],this.sessionInfoUpdate=e[3],this.sessionInfoLength=e[4],this.sessionInfoOffset=e[5],this.numVars=e[6],this.varHeaderOffset=e[7],this.numBuf=e[8],this.bufLen=e[9],this.bufOffset=e[13],this._parts=e.slice(10)}static fromBuffer(e){const r=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const a=e.length;if(a%i!==0)throw new RangeError("Buffer length must be a multiple of size. (buffer: ".concat(a,", size: ").concat(i,")"));if(s>=a)return t;{const a=e.slice(s,s+i).readInt32LE();return r(e,i,s+i,[...t,a])}};return new _(r(e))}}class f{constructor(e){Object.assign(this,e)}static fromBuffer(e){return new f({startDate:e.slice(0,8).readFloatLE(),startTime:e.slice(8,16).readDoubleLE(),endTime:e.slice(16,24).readDoubleLE(),lapCount:e.slice(24,28).readInt32LE(),recordCount:e.slice(28,32).readInt32LE()})}}const u=144;class h{constructor(e){Object.assign(this,e)}static fromBuffer(e){if(e.length!==u)throw new RangeError("Buffer length for VarHeader needs to be ".concat(u,", supplied ").concat(e.length));return new h({type:e.slice(0,4).readInt32LE(),offset:e.slice(4,8).readInt32LE(),count:e.slice(8,12).readInt32LE(),countAsTime:e.slice(12,13).readInt8(),name:e.slice(16,48).toString().replace(/\0/g,""),description:e.slice(48,112).toString().replace(/\0/g,""),unit:e.slice(112,144).toString().replace(/\0/g,"")})}}var g=i(82848);const{Buffer:p}=g.default,m=(e,r,i)=>new Promise(((s,a)=>{const n=p.alloc(i);t.read(e,n,0,i,r,((e,r)=>{e?a(e):s(n)}))})),S=e=>m(e,0,112).then(_.fromBuffer),M=e=>m(e,32,112).then(f.fromBuffer),v=(e,r)=>m(e,r.sessionInfoOffset,r.sessionInfoLength).then((e=>e.toString("ascii"))),I=(e,r)=>{const i=r.numVars,s=r.varHeaderOffset;return m(e,s,i*u).then((e=>l().range(0,i).map((r=>{const i=r*u,s=i+u;return h.fromBuffer(e.slice(i,s))}))))},L=e=>{return(r=e,new Promise(((e,i)=>{t.open(r,"r",((r,s)=>{r?i(r):e(s)}))}))).then((e=>{const r=[S(e),M(e)];return Promise.all(r).then((r=>{let[i,s]=r;return Promise.all([v(e,i),I(e,i)]).then((r=>{let[t,a]=r;return new R(i,s,t,a,e)}))}))}));var r},P=new WeakMap,b=new WeakMap;class R{constructor(e,r,i,s,t){this.headers=e,this.diskHeaders=r,this.sessionInfo=n().safeLoad(i),b.set(this,t),P.set(this,s)}static fromFile(e){return L(e)}get varHeaders(){return P.get(this)}uniqueId(){const e=this.sessionInfo.DriverInfo.Drivers[this.sessionInfo.DriverInfo.DriverCarIdx].UserID,r=this.sessionInfo.WeekendInfo.SessionID,i=this.sessionInfo.WeekendInfo.SubSessionID;return"".concat(e,"-").concat(r,"-").concat(i)}*samples(){let e=!0,r=0;const i=b.get(this),s=this.headers.bufLen,a=Buffer.alloc(s);for(;e;){const n=this.headers.bufOffset+r++*s;t.readSync(i,a,0,s,n)!==s?e=!1:yield new c(a,this.varHeaders)}}}const F=async e=>new Promise(((r,i)=>{const t=new FileReader;t.onload=()=>{const a=t.result;s.configure({fs:"InMemory"},(async t=>{if(t)return void i(t);const n=s.BFSRequire("fs"),{Buffer:d}=s.BFSRequire("buffer");n.writeFileSync(e.name,d.from(a));const o=await R.fromFile(e.name);r(o)}))},t.onerror=i,t.readAsArrayBuffer(e)}))}}]);
//# sourceMappingURL=424.253e577e.chunk.js.map